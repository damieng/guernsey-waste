<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Simple Trash Collection</title>
    <style type="text/css">
        body, ol, li { margin: 0; padding: 0; }
        ul, li { display: inline }
    </style>
  </head>
  <body>
    <ol id="output">
    </ol>
    <script>
        const address = window.location.search.substr(1)
        const out = document.getElementById('output')
        const imgBase = 'https://guernsey.isl-fusion.com'

        window
            .fetch(`https://app.damieng-work.workers.dev/${address}`)
            .then(response => response.json())
            .then(data => {
                out.innerHtml = ''

                for(const servicedate of Object.values(data.servicedates).slice(0,1)) {
                    const dateLi = document.createElement('li')
                    dateLi.innerText = new Date(servicedate.date).toLocaleDateString()
                    out.appendChild(dateLi)
                    const servicesUl = document.createElement('ul')
                    for(const serviceId of Object.values(servicedate.services)) {
                        const serviceLi = document.createElement('li')
                        const service = data.services[serviceId]
                        const serviceImg = document.createElement('img')
                        serviceImg.src = `${imgBase}${service.imageurl}`
                        serviceImg.title = service.name
                        serviceLi.appendChild(serviceImg)
                        servicesUl.appendChild(serviceLi)
                    }
                    out.appendChild(servicesUl)
                }
            });
    </script>
  </body>
</html>
